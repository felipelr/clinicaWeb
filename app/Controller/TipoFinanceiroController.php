<?php/* * To change this license header, choose License Headers in Project Properties. * To change this template file, choose Tools | Templates * and open the template in the editor. */App::uses('AuthController', 'Controller');App::uses('TipoFinanceiro', 'Model');/** * CakePHP TipoFinanceiroController * @author BersaN & StarK */class TipoFinanceiroController extends AuthController {    public function index() {    }    public function ajax() {        $this->layout = null;        $this->autoRender = false;        $columns = (isset($this->request->data["columns"])) ? $this->request->data["columns"] : null;        $order = (isset($this->request->data["order"])) ? $this->request->data["order"] : null;        $draw = (isset($this->request->data["draw"])) ? $this->request->data["draw"] : 0;        $start = (isset($this->request->data["start"])) ? $this->request->data["start"] : 0;        $length = (isset($this->request->data["length"])) ? $this->request->data["length"] : 0;        $search = (isset($this->request->data["search"]["value"]) && !empty($this->request->data["search"]["value"])) ? $this->request->data["search"]["value"] : null;        $ordenacao = $columns[$order[0]["column"]]["data"] . " " . strtoupper($order[0]["dir"]);        $content = new TipoFinanceiro();        $contents = $content->listarJQuery($search, $start, $length, $ordenacao);                $this->response->body(json_encode(                        array(                            "draw" => $draw,                            "recordsTotal" => (int) $content->totalRegistro(),                            "recordsFiltered" => (int) $content->totalRegistroFiltrado($search),                            "data" => $contents                        )        ));    }    public function cadastrar() {        if ($this->request->is("post")) {            $this->layout = null;            $this->autoRender = false;            $data = $this->request->data;            $dataTipoFinanceiro = $data["TipoFinanceiro"];            $tipoFinanceiro = new TipoFinanceiro();            $tipoFinanceiro->save($dataTipoFinanceiro);            $layout = isset($this->request->query['layout']) ? $this->request->query['layout'] : null;            if (isset($layout)) {                $this->response->body(json_encode($tipoFinanceiro->retornarPorId($tipoFinanceiro->id)));            } else {                $this->Session->setFlash(__("Cadastrado com sucesso."), 'sucesso');                return $this->redirect(array("controller" => "tipo_financeiro", "action" => "index"));            }        }        if ($this->request->is("get")) {            $layout = isset($this->request->query['layout']) ? $this->request->query['layout'] : null;            if (isset($layout)) {                $this->layout = "ajax";            }        }    }    public function alterar($idtipofinanceiro) {        $TipoFinanceiro = new TipoFinanceiro();        if ($this->request->is("get")) {            if (isset($idtipofinanceiro)) {                $TipoFinanceiro = $TipoFinanceiro->listarPorId($idtipofinanceiro);                $this->set("Tipo", $TipoFinanceiro);            } else {                return $this->redirect(array("controller" => "Tipo_financeiro", "action" => "index"));            }        }        if ($this->request->is("post")) {            $data = $this->request->data;            $dataFinanceiro = $data["Tipo"];            $TipoFinanceiro = new TipoFinanceiro();            $TipoFinanceiro->save($dataFinanceiro);            $this->Session->setFlash(__("Atualizado com sucesso."), 'sucesso');            return $this->redirect(array("controller" => "tipo_financeiro", "action" => "index"));        }    }    public function excluir() {        $idfinanceirotipo = $this->request->data['idfinanceirotipo'];        $this->autoRender = false;        $this->layout = null;        if ($this->request->is("post")) {            if (isset($idfinanceirotipo)) {                $financeiro_tipo = new TipoFinanceiro();                $financeiro_tipo->idfinanceirotipo = $idfinanceirotipo;                $financeiro_tipo->excluir($idfinanceirotipo);                $this->Session->setFlash(__("ExcluÃ­do com sucesso!"), 'sucesso');            }        }        return $this->redirect(array("controller" => "tipo_financeiro", "action" => "index"));    }}